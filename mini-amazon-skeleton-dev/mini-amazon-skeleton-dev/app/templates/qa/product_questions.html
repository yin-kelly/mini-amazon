{% extends "base.html" %}
{% block title %}Questions - {{ product_name }}{% endblock %}
{% block content %}

<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Questions & Answers</h2>
    <div>
      <a href="{{ url_for('index.product_detail', product_id=product_id) }}" class="btn btn-outline-secondary">
        <i class="fas fa-arrow-left"></i> Back to Product
      </a>
      {% if current_user.is_authenticated %}
        <a href="{{ url_for('qa.ask_question', product_id=product_id) }}" class="btn btn-primary">
          <i class="fas fa-plus"></i> Ask Question
        </a>
      {% endif %}
    </div>
  </div>

  {% if questions %}
    {% for question in questions %}
    <div class="card mb-4">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-start mb-2">
          <h5 class="card-title mb-0">{{ question.title }}</h5>
          <small class="text-muted">{{ question.created_at.strftime('%Y-%m-%d') }}</small>
        </div>
        
        <p class="card-text">{{ question.content }}</p>
        
        <div class="d-flex justify-content-between align-items-center">
          <small class="text-muted">
            Asked by <strong>{{ question.asker_name }}</strong>
          </small>
          
          {% if current_user.is_authenticated %}
            <button class="btn btn-sm btn-outline-primary" onclick="toggleAnswerForm({{ question.id }})">
              <i class="fas fa-reply"></i> Answer
            </button>
          {% endif %}
        </div>
        
        <!-- Answer form (hidden by default) -->
        <div id="answer-form-{{ question.id }}" class="mt-3" style="display: none;">
          <form method="POST" action="{{ url_for('qa.answer_question', question_id=question.id) }}">
            <div class="form-group">
              <textarea name="content" class="form-control" rows="3" 
                        placeholder="Write your answer..." required></textarea>
            </div>
            <div class="d-flex justify-content-end">
              <button type="button" class="btn btn-secondary btn-sm mr-2" 
                      onclick="toggleAnswerForm({{ question.id }})">Cancel</button>
              <button type="submit" class="btn btn-primary btn-sm">Post Answer</button>
            </div>
          </form>
        </div>
        
        <!-- Answers will be loaded here via AJAX or shown inline -->
        <div id="answers-{{ question.id }}" class="mt-3">
          <!-- Answers will be populated here -->
        </div>
      </div>
    </div>
    {% endfor %}
  {% else %}
    <div class="text-center py-5">
      <h4 class="text-muted">No questions yet</h4>
      <p class="text-muted">Be the first to ask a question about this product!</p>
      {% if current_user.is_authenticated %}
        <a href="{{ url_for('qa.ask_question', product_id=product_id) }}" class="btn btn-primary">
          Ask Question
        </a>
      {% endif %}
    </div>
  {% endif %}
</div>

<script>
function toggleAnswerForm(questionId) {
  const form = document.getElementById('answer-form-' + questionId);
  if (form.style.display === 'none') {
    form.style.display = 'block';
  } else {
    form.style.display = 'none';
  }
}
</script>

{% endblock %}
