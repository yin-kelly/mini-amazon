{% extends "base.html" %}
{% block title %}{{ user_info.firstname }} {{ user_info.lastname }} - Public Profile{% endblock %}
{% block content %}

<div class="container my-4">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card shadow-sm">
        <div class="card-header">
          <h4 class="mb-0">{{ user_info.firstname }} {{ user_info.lastname }}</h4>
          <small class="text-muted">User ID: {{ user_info.id }}</small>
        </div>
        <div class="card-body">
          
          <!-- Basic Information -->
          <div class="row mb-4">
            <div class="col-md-6">
              <h6>Contact Information</h6>
              <p class="mb-1"><strong>Email:</strong> {{ user_info.email }}</p>
              {% if user_info.address %}
                <p class="mb-1"><strong>Address:</strong> {{ user_info.address }}</p>
              {% endif %}
            </div>
            <div class="col-md-6">
              {% if is_seller %}
                <h6>Seller Information</h6>
                <div class="alert alert-info">
                  <i class="fas fa-store"></i> This user is a verified seller
                </div>
              {% else %}
                <h6>Account Type</h6>
                <div class="alert alert-secondary">
                  <i class="fas fa-user"></i> Regular user account
                </div>
              {% endif %}
            </div>
          </div>

          <!-- Seller Reviews Section -->
          {% if is_seller %}
            <hr>
            <h5>Seller Reviews</h5>
            
            {% if review_count > 0 %}
              <!-- Average Rating -->
              <div class="row mb-3">
                <div class="col-md-6">
                  <div class="card border-primary">
                    <div class="card-body text-center">
                      <h3 class="text-primary">{{ avg_rating }}/5</h3>
                      <div class="mb-2">
                        {% for i in range(5) %}
                          {% if i < avg_rating|int %}<span class="star filled text-warning">★</span>
                          {% elif i == avg_rating|int and avg_rating - avg_rating|int >= 0.5 %}<span class="star filled text-warning">★</span>
                          {% else %}<span class="star text-muted">☆</span>
                          {% endif %}
                        {% endfor %}
                      </div>
                      <small class="text-muted">{{ review_count }} review{{ 's' if review_count != 1 else '' }}</small>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Reviews List -->
              <div class="reviews-section">
                <h6>Recent Reviews</h6>
                {% for review in seller_reviews[:5] %}
                  <div class="card mb-3">
                    <div class="card-body">
                      <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                          <strong>{{ review.reviewer_name }}</strong>
                          <div class="rating">
                            {% for i in range(5) %}
                              {% if i < review.rating %}<span class="star filled text-warning">★</span>
                              {% else %}<span class="star text-muted">☆</span>
                              {% endif %}
                            {% endfor %}
                          </div>
                        </div>
                        <small class="text-muted">{{ review.created_at.strftime('%Y-%m-%d') }}</small>
                      </div>
                      <p class="mb-2">{{ review.feedback }}</p>
                      
                      <!-- Review Images -->
                      {% if review.images %}
                        <div class="review-images mb-2">
                          {% for image in review.images %}
                            <img src="{{ url_for('reviews.view_image', image_id=image.id) }}" 
                                 class="img-thumbnail mr-2 mb-2" 
                                 style="max-width: 100px; max-height: 100px;"
                                 alt="{{ image.original_name }}">
                          {% endfor %}
                        </div>
                      {% endif %}
                      
                      <!-- Upvote Button -->
                      <div class="review-actions">
                        <form method="POST" action="{{ url_for('reviews.toggle_upvote', review_type='seller', review_id=review.id) }}" style="display: inline;">
                          <button type="submit" class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-thumbs-up"></i> 
                            {% if review.user_has_upvoted %}Unlike{% else %}Like{% endif %}
                            ({{ review.upvote_count }})
                          </button>
                        </form>
                      </div>
                    </div>
                  </div>
                {% endfor %}
                
                {% if seller_reviews|length > 5 %}
                  <div class="text-center">
                    <small class="text-muted">Showing 5 of {{ seller_reviews|length }} reviews</small>
                  </div>
                {% endif %}
              </div>
            {% else %}
              <div class="alert alert-info">
                <i class="fas fa-info-circle"></i> No reviews yet for this seller.
                {% if current_user.is_authenticated and current_user.id != user_info.id %}
                  <div class="mt-2">
                    <a href="{{ url_for('reviews.new_seller_review', seller_id=user_info.id) }}" 
                       class="btn btn-sm btn-primary">
                      Write Review
                    </a>
                  </div>
                {% endif %}
              </div>
            {% endif %}
            
            {% if current_user.is_authenticated and current_user.id != user_info.id and review_count > 0 %}
              <div class="text-center mt-3">
                <a href="{{ url_for('reviews.new_seller_review', seller_id=user_info.id) }}" 
                   class="btn btn-outline-primary">
                  Write Review
                </a>
              </div>
            {% endif %}
          {% endif %}

          <!-- Navigation -->
          <hr>
          <div class="d-flex justify-content-between">
            <a href="{{ url_for('index.index') }}" class="btn btn-secondary">Back to Home</a>
            {% if current_user.is_authenticated and current_user.id != user_info.id %}
              <a href="{{ url_for('index.index') }}" class="btn btn-primary">Browse Products</a>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.star {
  font-size: 1.2em;
}
.star.filled {
  color: #ffc107;
}
</style>

{% endblock %}
