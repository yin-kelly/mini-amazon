{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <h2>Seller Dashboard</h2>
  
  <!-- Flash Messages -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <!-- Simple Tab-style Navigation -->
  <div class="btn-group mb-3" role="group">
    <a href="{{ url_for('seller.index') }}" class="btn btn-primary">Inventory</a>
    <a href="{{ url_for('seller.orders') }}" class="btn btn-outline-primary">Orders</a>
  </div>

  <!-- Inventory Content -->
  <div class="card p-3">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h4>Product Inventory</h4>
      <button class="btn btn-dark" data-toggle="modal" data-target="#addModal">+ Add Product</button>
    </div>

    {% if items %}
      {% for inv in items %}
        {% set p = product_map.get(inv.product_id) %}
        <div class="card p-3 mb-2 d-flex align-items-center">
          <div class="flex-grow-1">
            <strong>{{ p.name if p else ('Product ' ~ inv.product_id) }}</strong><br>
            Price: ${{ "%.2f"|format(inv.price) }} &nbsp;&nbsp; Stock: {{ inv.quantity }}
          </div>
          <div class="ml-3">
            <a class="btn btn-primary btn-sm" href="{{ url_for('seller.edit_inventory_item', inventory_id=inv.inventory_id) }}">Edit</a>
            <form action="{{ url_for('seller.delete_inventory_item', inventory_id=inv.inventory_id) }}" method="POST" style="display:inline;">
              <input type="submit" value="Delete" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this inventory item?')"/>
            </form>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <p>No inventory items yet.</p>
    {% endif %}
  </div>
</div>

<!-- Modal form for creating new products (keep your existing modal) -->
<div class="modal fade" id="addModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <form class="modal-content" method="POST" action="{{ url_for('seller.create_product') }}">
      <div class="modal-header">
        <h5 class="modal-title">Add New Product</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-md-6">
            <div class="mb-3">
              <label>Product Name *</label>
              <input name="name" class="form-control" required placeholder="Enter product name" />
            </div>
            <div class="mb-3">
              <label>Price *</label>
              <div class="input-group">
                <span class="input-group-addon">$</span>
                <input name="price" type="number" step="0.01" class="form-control" required min="0.01" placeholder="0.00" />
              </div>
            </div>
            <div class="mb-3">
              <label>Stock Quantity *</label>
              <input name="stock" type="number" class="form-control" required min="1" placeholder="1" />
            </div>
          </div>
          <div class="col-md-6">
            <div class="mb-3">
              <label>Category</label>
              <select name="category" class="form-control" required>
                <option value="">-- Select a category --</option>
                <option value="Electronics">Electronics</option>
                <option value="Books">Books</option>
                <option value="Clothing">Clothing</option>
                <option value="Home">Home</option>
                <option value="Beauty">Beauty</option>
              </select>
            </div>
            <div class="mb-3">
              <label>Image URL</label>
              <input name="image" type="url" class="form-control" placeholder="https://example.com/image.jpg" />
            </div>
          </div>
        </div>
        <div class="mb-3">
          <label>Description *</label>
          <textarea name="description" class="form-control" rows="3" required placeholder="Describe your product..."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <input type="submit" class="btn btn-primary" value="Create Product" />
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
      </div>
    </form>
  </div>
</div>

{% endblock %}
